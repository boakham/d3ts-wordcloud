{"version":3,"file":"d3ts-wordcloud.mjs","sources":["../../../projects/d3ts-wordcloud/src/lib/index.ts","../../../projects/d3ts-wordcloud/src/public-api.ts","../../../projects/d3ts-wordcloud/src/d3ts-wordcloud.ts"],"sourcesContent":["import {D3CloudTs} from 'd3-cloud-ts';\r\n\r\nimport * as d3 from 'd3';\r\n\r\n\r\n\r\nexport class D3TsWordcloud {\r\n\r\n    protected svg!: d3.Selection<SVGSVGElement, unknown, null, undefined>;\r\n    protected vis!: any;\r\n  \r\n    protected fill!: d3.ScaleOrdinal<string, string, never>;\r\n  \r\n    protected cloud!: D3CloudTs.Cloud;\r\n  \r\n    protected fontSize!: d3.ScalePower<number, number, never>;\r\n  \r\n    constructor(\r\n      protected targetElement: HTMLDivElement,\r\n      protected tags: D3CloudTs.Word[],\r\n      protected ratio: number = 0.5625,\r\n      protected fontFamily: string = 'impact',\r\n      protected fontSizeRange: number[] = [10, 80],\r\n    ) {\r\n      this.init();\r\n    }\r\n  \r\n    update(): void {\r\n      this.cloud.config.font?.(this.fontFamily).spiral?.('archimedean');\r\n      this.fontSize = d3.scaleSqrt().range(this.fontSizeRange);\r\n  \r\n      if (this.tags.length) {\r\n        this.fontSize.domain([+this.tags[this.tags.length - 1].value || 1, +this.tags[0].value]);\r\n      }\r\n      this.cloud.config.stop?.().words?.(this.tags).start?.();\r\n    }\r\n  \r\n    protected init(): void {\r\n      this.fill = d3.scaleOrdinal(d3.schemeSet1);\r\n      const w = 360;//this.targetElement.parentElement.offsetWidth;\r\n      const h = 200;//this.targetElement.parentElement.offsetWidth * this.ratio;\r\n  \r\n      this.cloud = new D3CloudTs.Cloud();\r\n      this.cloud.config\r\n        .timeInterval?.(Infinity)\r\n        .size?.([w, h])\r\n        .fontSize?.((_: any, d: D3CloudTs.Word, i: number) => this.fontSize(+d.value))\r\n        .text?.((_: any, d: D3CloudTs.Word, i: number) => d.key)\r\n        .on?.(['end', this.draw.bind(this)]);\r\n  \r\n      this.svg = d3.select(this.targetElement).append('svg')\r\n        .attr('width', w)\r\n        .attr('height', h);\r\n      this.vis = this.svg.append('g')\r\n      this.vis = this.vis.attr('transform', 'translate(' + [w >> 1, h >> 1] + ')');\r\n  \r\n      this.update();\r\n  \r\n      if ((<any>window).attachEvent) {\r\n        (<any>window).attachEvent('onresize', this.update.bind(this));\r\n      } else if (window.addEventListener) {\r\n        window.addEventListener('resize', this.update.bind(this));\r\n      }\r\n    }\r\n  \r\n    protected draw(data: D3CloudTs.Word[], bounds: { x: number, y: number }[]): void {\r\n  \r\n      const w = 360;//this.targetElement.parentElement.offsetWidth;\r\n      const h = 200;//this.targetElement.parentElement.offsetWidth * this.ratio;\r\n      this.svg.attr('width', w).attr('height', h);\r\n  \r\n      const scale = bounds ? Math.min(\r\n        w / Math.abs(bounds[1].x - w / 2),\r\n        w / Math.abs(bounds[0].x - w / 2),\r\n        h / Math.abs(bounds[1].y - h / 2),\r\n        h / Math.abs(bounds[0].y - h / 2)) / 2 : 1;\r\n  \r\n  \r\n      const text = this.vis.selectAll('text').data(data, (d: any) => d.text.toLowerCase());\r\n  \r\n      text.transition()\r\n        .duration(1000)\r\n        .attr('transform', (d: any) => 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')')\r\n        .style('font-size', (d: any) => d.size + 'px');\r\n  \r\n      text.enter()\r\n        .append('text')\r\n        .style('opacity', 1e-6)\r\n        .transition()\r\n        .duration(1000)\r\n        .attr('text-anchor', 'middle')\r\n        .attr('transform', (d: any) => 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')')\r\n        .style('font-size', (d: any) => d.size + 'px')\r\n        .style('opacity', 1)\r\n        .text((d: any) => d.text)\r\n        .style('font-family', (d: any) => d.font)\r\n        .style('fill', (d: any) => this.fill(d.text.toLowerCase()));\r\n  \r\n      this.vis.transition()\r\n        .attr('transform', 'translate(' + [w >> 1, h >> 1] + ')scale(' + scale + ')');\r\n    }\r\n  }\r\n  ","/*\n * Public API Surface of d3ts-wordcloud\n */\n\nexport * from './lib/index';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}